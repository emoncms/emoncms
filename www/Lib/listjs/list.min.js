/*

  list.js is released under the GNU Affero General Public License.
  See COPYRIGHT.txt and LICENSE.txt.

  Part of the OpenEnergyMonitor project:
  http://openenergymonitor.org
 
*/

var list={data:{},fields:{},element:"#table",init:function(){var a=$('<table class="table table-hover" />'),b;for(field in list.fields){b=$("<tr />").attr("field",field);b.append('  <td type="name" class="muted" style="width:150px;">'+list.fields[field].title+"</td>");b.append('  <td type="value">'+(list.fieldtypes[list.fields[field].type].draw(list.data[field])||"N/A")+"</td>");b.append('  <td type="edit" action="edit"><i class="icon-pencil" style="display:none"></i></td>');a.append(b)}$(list.element).html(a);$(list.element+" td[type=edit]").click(function(){var c=$(this).attr("action");var d=$(this).parent().attr("field");if(c=="edit"){$(list.element+" tr[field="+d+"] td[type=value]").html(list.fieldtypes[list.fields[d].type].edit(d,list.data[d]));$(this).html("<a>Save</a>").attr("action","save")}if(c=="save"){list.data[d]=list.fieldtypes[list.fields[d].type].save(d);$(list.element+" tr[field="+d+"] td[type=value]").html(list.fieldtypes[list.fields[d].type].draw(list.data[d]));$(this).html("<i class='icon-pencil' style='display:none'></i>").attr("action","edit");$(list.element).trigger("onSave",[])}});$(list.element+" tr").hover(function(){$(this).find("td:last > i").show()},function(){$(this).find("td:last > i").hide()})},fieldtypes:{text:{draw:function(a){return a},edit:function(b,a){return"<input type='text' value='"+(a||"")+"' / >"},save:function(a){return $(list.element+" tr[field="+a+"] td[type=value] input").val()}},select:{draw:function(a){return a},edit:function(d,c){var a="";for(i in list.fields[d].options){var b="";if(list.fields[d].options[i]==c){b="selected"}a+="<option value="+list.fields[d].options[i]+" "+b+">"+list.fields[d].options[i]+"</option>"}return"<select>"+a+"</select>"},save:function(a){return $(list.element+" tr[field="+a+"] td[type=value] select").val()}},timezone:{draw:function(b){var a=b>=0?"+":"";return"UTC "+a+(b||0)+":00"},edit:function(g,f){var b=$("<select />"),a=null,c;for(var d=-12;d<=14;d++){var e="";if(f==d){e="selected";a=d}c=d>=0?"+":"";b.append("<option value="+d+" "+e+">UTC "+c+d+":00</option>")}if(a===null){b.find("option[value='0']").attr("selected","selected")}return b.wrap("<p>").parent().html()},save:function(a){return $(list.element+" tr[field="+a+"] td[type=value] select").val()}},gravatar:{draw:function(a){return"<img style='border: 1px solid #ccc; padding:2px;' src='http://www.gravatar.com/avatar/"+CryptoJS.MD5(a)+"'/ >"},edit:function(b,a){return"<input type='text' value='"+a+"' / >"},save:function(a){return $(list.element+" tr[field="+a+"] td[type=value] input").val()}}}};