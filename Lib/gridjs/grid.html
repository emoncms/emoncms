<!--
    see grid.js for install instructions
-->
<!-- ---------------------------------------------------------------- -->
<!-- GRID -> ROW -> COLUMN -> INPUT TEPLATE -->
<script type="text/x-template" id="grid-input">
    <div class="control-group mb-0">
        <div class="controls">
            <input @input="input" :value="value" type="text" class="form-control border-0 m-0 w-auto" @keyup.enter="enterPressed" :title="title">
            <span class="help-inline d-none d-sm-block text-right"></span>
        </div>
    </div>
</script>



<!-- ---------------------------------------------------------------- -->
<!-- GRID -> ROW -> COLUMN TEMPLATE -->
<script type="text/x-template" id="grid-column">
    <td :class="{'d-none d-sm-table-cell': column.hideNarrow}">
        <template v-if="column.icon">

            <!-- show link -->
            <a v-if="column.link"
                @click="input"
                class="btn btn-sm-md btn-small"
                :class="entry.id.toString() === selected.toString() ? 'active' : classNames.button"
                :title = "title"
                :href="entry[property]">
                <svg class="icon"><use :xlink:href="column.icon"></use></svg>
            </a>

            <!-- show toggle -->
            <button v-else-if="typeof entry[property] === 'boolean'"
                @click="input"
                class="btn btn-sm-md btn-small"
                :class="entry[property] ? classNames.buttonActive + ' active' : classNames.button"
                :title = "title">
                <svg class="icon"><use :xlink:href="column.icon"></use></svg>
            </button>

            <!-- show button -->
            <button v-else
                @click="input"
                class="btn btn-light btn-sm-md btn-small"
                :title = "title">
                <svg class="icon"><use :xlink:href="column.icon"></use></svg>
            </button>
        </template>

        <template v-else-if="column.values">
            <!-- show dropdown -->
            <select class="w-auto mb-0">
                <option v-for="(option, optIndex) in column.values" :value="option.value"
                :selected="entry[property] === option.value"
                :title = "title"
                @field:input="input">
                    {{option.name}}
                </option>
                <option value="">{{ _('Custom') }}</option>
            </select>
        </template>
        
        <template v-else>
            <!-- show html -->
            <div v-if="column.raw" v-html="entry[property]"></div>

            <!-- show editable text -->
            <grid-input v-else-if="column.input"
                :title = "title"
                :property="property"
                @field:input="input"
                :value="entry[property]">
            </grid-input>

            <!-- show toggle with default tickbox -->
            <button v-else-if="typeof entry[property] === 'boolean'"
                @click="input"
                class="btn btn-sm-md btn-small"
                :class="entry[property] ? classNames.buttonActive + ' active' : classNames.button"
                :title = "title">
                <svg class="icon"><use :xlink:href="'#icon-' + (entry[property] === true ? 'checkbox-checked' : 'checkbox-unchecked')"></use></svg>
            </button>

            <!-- show text -->
            <span v-else :data-type="typeof entry[property]">
                {{entry[property]}}
            </span>
        </template>
    </td>
</script>



<!-- ---------------------------------------------------------------- -->
<!-- GRID -> ROW TEMPLATE -->
<script type="text/x-template" id="grid-row">
    <tr>
        <grid-column v-for="(column, colIndex) in columns"
            :key="colIndex"
            :entry="entry"
            :property="colIndex"
            :column="column"
            :class-names="classNames"
            :selected="selected"
        >
        </grid-column>
    </tr>
</script>



<!-- ---------------------------------------------------------------- -->
<!-- DATA GRID TEMPLATE -->
<script type="text/x-template" id="grid-data">
    <table class="table table-sm table-hover table-condensed">
        <caption v-if="status" class="text-muted muted text-left mt-3">{{ status.title }}</caption>
        <thead>
            <tr>
                <th v-for="(column, key) in columns" v-if="column.sort"
                    :key="key"
                    :class="{ active: sortKey == key, 'd-none d-sm-table-cell': column.hideNarrow}"
                    :title="column.title"
                    @click="sortBy(key)">
                    <!-- sortable headers required-->
                    <a href="#" class="text-body d-flex align-items-center" :class="{'pl-2': column.input}">
                        <span v-if="column.label">{{ column.label | capitalize }}</span>
                        <span v-else>{{ key | capitalize }}</span>
                        <span class="arrow" :class="sortOrders[key] > 0 ? 'asc' : 'dsc'"></span>
                    </a>
                </th>
                <th v-else-if="!column.noHeader" :class="{'d-none d-sm-table-cell': column.hideNarrow}">
                    <!-- header required-->
                    <span v-if="column.label">{{ column.label | capitalize }}</span>
                    <span v-else>{{ key | capitalize }}</span>
                </th>
                <th v-else :class="{'d-none d-sm-table-cell': column.hideNarrow}"><!-- header not required--></th>
            </tr>
        </thead>
        <tbody>
            <grid-row v-for="(entry, rowIndex) in filteredColumns"
                :key="entry.id"
                :data-key="entry.id"
                :data-selected="selected"
                :entry="entry"
                :columns="columns"
                :class-names="classNames"
                :selected="selected"
                :class="[selected.toString() === entry.id.toString() ? classNames.selectedRow: '']"
                >
            </grid-row>
        </tbody>
    </table>
</script>